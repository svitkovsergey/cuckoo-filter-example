# Streaming example
Докер-образ: `sbt docker:publishLocal`, экспоузил 8080 порт
## Preface
Специально взял за основу http4s с fs2, тк почти не работал ранее с этими библиотеками.
На akka-http с этим было бы куда [проще](https://doc.akka.io/docs/akka-http/current/routing-dsl/source-streaming-support.html#consuming-json-streaming-uploads), но мне захотелось поэкспериментировать (не могу сказать, что я доволен тем, что получилось, но на это мне, по крайней мере, интересно получить фидбэк и предложения по возможным улучшениям).

p.s.: **circe-generic-extras, судя по всему, нельзя подружить с http4s-circe, поэтому, пожалуйста, используйте в json'ах camel case** 
## Оценка временной сложности решения и некоторые рассуждения о репликации
За основу взял TrieMap для хранения количества встретившихся уникальных значений и cuckoo-filter для отсеивания уже встретившихся значений. 
Если верить статье https://www.cs.cmu.edu/~dga/papers/cuckoo-conext2014.pdf, то в худшем случае (уже встретили все возможные 10^10 значений) размер хранимого ин-мемори состояния будет не более 2 гб (очень грубая оценка, если считать по формулам из статьи то где-то 750мб, но судя по тому, что описано в evaluation, где-то ближе к 1.2. Учитывая возможные погрешности реализации, пусть будет ~2). 

Таким образом, каждый элемент обрабатывается за константное время. Плюс, можно сделать снэпшот за константное время, что может быть полезно при запуске решения в несколько реплик.

В случае с запуском нескольких реплик можно сохранять timeuuid последнего обновления и снэпшот состояния. 
В неприятных ситуациях можно будет помержить по last writer wins. 

